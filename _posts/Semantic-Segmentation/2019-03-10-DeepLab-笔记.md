---
layout: post
title: DeepLab 笔记
category: 语义分割
tags: deeplab
description:
---

## 一、背景

DCNN 存在的问题：

1. 多次下采样使输出信号分辨率变小 —— 空洞卷积
2. 池化对输入变换具有内在空间不变性 —— CRF

## 感受野

感受野被定义为卷积神经网络特征所能看到输入图像的区域，换句话说特征输出受感受野区域内的像素点的影响。

比如下图（该图为了方便，将二维简化为一维），这个三层的神经卷积神经网络，每一层卷积核的kernel_size = 3 ，stride = 1，那么最上层特征所对应的感受野就为如图所示的7x7。

<center>

<img src="https://raw.githubusercontent.com/chiemon/chiemon.github.io/master/img/DeepLab/v1-1.png">

</center>

感受野计算公式：

$$RF_{l+1} = RF_{l} + \left( kernel\_size_{l+1} - 1 \right) \times feature\_stride_{l}$$

其中：RF 表示特征感受野大小，l 表示层数，$feature\_stride_{l} = \prod_{i=1}^{l} stride_{i}$ 表示输入层，$RF_{0} = 1$，$feature\_stride_{0} = 1$。

- 第一层特征，感受野为 3

$$RF_{1} = RF_{0} + \left( kernel\_size_{1} - 1 \right) \times feature\_stride_{0} = 1 + \left( 3 - 1\right) \times 1 = 3$$

<center>

<img src="https://raw.githubusercontent.com/chiemon/chiemon.github.io/master/img/DeepLab/v1-2.png">

</center>

- 第二层特征，感受野为 5

$$RF_{2} = RF_{1} + \left( kernel\_size_{2} - 1 \right) \times feature\_stride_{1} = 3 + \left( 3 - 1\right) \times 1 = 5$$

<center>

<img src="https://raw.githubusercontent.com/chiemon/chiemon.github.io/master/img/DeepLab/v1-3.png">

</center>

- 第三层特征，感受野为 7

$$RF_{3} = RF_{2} + \left( kernel\_size_{3} - 1 \right) \times feature\_stride_{2} = 5 + \left( 3 - 1\right) \times 1 = 5$$

<center>

<img src="https://raw.githubusercontent.com/chiemon/chiemon.github.io/master/img/DeepLab/v1-4.png">

</center>

## 空洞卷积

作用

- 保证感受野不发生变化
- 得到密集的 feature map

原理

空洞卷积的感受野

$$RF_{l+1} = RF_{l} + \left( kernel\_size_{l+1} - 1 \right) \times feature\_stride_{l} \times \left( dilation_{l+1} - 1\right)$$


## DeepLab V1

### 网络结构

<center>

<img src="https://raw.githubusercontent.com/chiemon/chiemon.github.io/master/img/DeepLab/v1-10.png">

</center>

上图为 VGG16 网络，DeepLab v1 在此网络上修改。

1. 全连接层替换为卷积层；
2. 改变 kernel：

    将 VGG16 网络的 pool4 和 pool5 层的 stride 由原来的2改为了1，再加上 1 padding。使得 VGG16 网络总的 stride 由原来的 32 变成 8，进而使得在输入图像为 514x514 时，fc7 能得到 67x67 的score map。

3. 引入空洞卷积:

    stride改变以后，如果想继续利用vgg model进行fine tuning，会导致后面感受野发生变化。

    <center>

    <img src="https://raw.githubusercontent.com/chiemon/chiemon.github.io/master/img/DeepLab/v1-11.png">

    </center>

4. 将最后一层的类别1000的分类器替换为类别21的一个，损失函数是卷积 output map 上每个空间位置交叉熵的求和；

5. 感受野：VGG16 的感受野为224x224，如果应用卷积后，为 404x404，将 VGG16 变为全卷积后，第一个全连接层会有 4096 个大小为 7x7 的 filters，这大大增加了计算的难度。该文减少第一个全连接层 filter 的空间尺寸（3x3），但也相对应的减少了网络的感受野（128x128 or 308x308），减少了 2 到 3 倍的计算时间，同时，全连接层通道数的减小也有效果。



## DeepLab V2

### 网络结构

## DeepLab V3

### 网络结构

## DeepLab V3+

### 网络结构
