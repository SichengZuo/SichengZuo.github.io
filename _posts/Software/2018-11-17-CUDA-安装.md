---
layout: post
title: CUDA 安装
category: Software
tags: cuda
description:
---

# 版本查询

```bash
# cuda 版本
cat /usr/local/cuda/version.txt

# cudnn 版本
cat /usr/local/cuda/include/cudnn.h | grep CUDNN_MAJOR -A 2
```

# 下载链接

[cuda](https://developer.nvidia.com/cuda-zone), [cudnn](https://developer.nvidia.com/cudnn), [NVIDIA显卡驱动](https://www.nvidia.cn/Download/index.aspx?lang=cn)

# cuda 安装

### 下载 nvidia 显卡驱动

### 禁用集成显卡

- 在 /etc/modprobe.d 目录中创建文件 blacklist-nouveau.conf，并输入以下内容：

    ```
    blacklist nouveau
    options nouveau modeset=0
    ```

- 执行：

    ```bash
    sudo update-initramfs -u
    ```

- 验证

    ```bash
    lsmod | grep nouveau    # 若无内容输出，则表示禁用成功。
    ```
### 安装 nvidia 显卡驱动

# cuda安装

- 重启电脑，按 Ctrl + Alt + F1 进入命令行模式，登陆账户;

- 关闭图形化界面;

    ```bash
    sudo service lightdm stop
    ```

- cd 到下载好的 cuda runfile 文件所在路径;

- 安装

    ```bash
    sudo sh cuda_8.0.61_375.26_linux.run
    ```

    安装过程：

    ```bash
    Do accept the previously read EULA?
    accept/decline/quit: accept

    Install NVIDIA Accelerated Graphics Driver for Linux-x86_64 xxx.xx?
    (y)es/(n)o/(q)uit: n                          # 已单独安装了最新的显卡驱动

    Install the CUDA xx Toolkit?
    (y)es/(n)o/(q)uit: y

    Enter Toolkit Location
     [ default is /usr/local/cuda-xx ]:                         # 直接回车
    
    Do you want to install a symbolic link at /usr/local/cuda?
    (y)es/(n)o/(q)uit: y

    Install the CUDA xx Samples?
    (y)es/(n)o/(q)uit: y

    Enter CUDA Samples Location
     [ default is /home/xxx ]:                                  # 直接回车

    Installing the CUDA Toolkit in /usr/local/cuda-xx ...       # 等待安装完成
    ```

- 重启图形化界面;

    ```bash
    sudo service lightdm restart    # 会自动跳转到图形化界面，登录账户
    ```

- 验证

    ```bash
    cd ~/NVIDIA_CUDA-XX_Samples

    make -j8

    cd bin/x86_64/linux/release

    ./bandwidthTest

    ./deviceQuery
    ```

- 添加本地环境变量

    ```bash
    vim ~/.bashrc
    # 末尾添加
    export PATH=/home/michael/local/cuda_8.0.61/bin:$PATH
    export LD_LIBRARY_PATH=/home/michael/local/cuda_8.0.61/lib64$LD_LIBRARY_PATH
    ```

- 更新环境变量

    ```bash
    source ~/.bashrc
    ```

# cudnn安装

- nvidia 官网下载与 cuda 版本对应的 cudnn.

- 解压，将解压文件夹中, include 目录下的文件拷贝或移动到 cuda 安装目录的头文件夹中.

    ```bash
    sudo mv cuda/include/* /usr/local/cuda-10.0/include/
    ```

    将解压文件中，lib 或 lib64 目录下的文件拷贝或移动到 cuda 安装目录的库文件夹中.

    ```bash
    sudo mv cuda/lib64/* /usr/local/cuda-10.0/lib64/
    ```

    这里 cudnn 放入到 cuda 的包含目录里面了，也可以不放进 cuda 里，放在外面之后要改环境变量。