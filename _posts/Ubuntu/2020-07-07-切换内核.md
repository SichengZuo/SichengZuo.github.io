---
layout: post
title: 切换内核
category: Ubuntu
tags: Ubuntu
keywords: 内核
description:
---

1. 首先找到内核名称

```bash
grep menuentry /boot/grub/grub.cfg
```

显示如下

```bash
if [ x"${feature_menuentry_id}" = xy ]; then
  menuentry_id_option="--id"
  menuentry_id_option=""
export menuentry_id_option
menuentry 'Ubuntu' --class ubuntu --class gnu-linux --class gnu --class os $menuentry_id_option 'gnulinux-simple-078e99ce-eb46-4324-bd9b-6dc10573508b' {
submenu 'Advanced options for Ubuntu' $menuentry_id_option 'gnulinux-advanced-078e99ce-eb46-4324-bd9b-6dc10573508b' {
	menuentry 'Ubuntu, with Linux 4.4.0-184-generic' --class ubuntu --class gnu-linux --class gnu --class os $menuentry_id_option 'gnulinux-4.4.0-184-generic-advanced-078e99ce-eb46-4324-bd9b-6dc10573508b' {
	menuentry 'Ubuntu, with Linux 4.4.0-184-generic (upstart)' --class ubuntu --class gnu-linux --class gnu --class os $menuentry_id_option 'gnulinux-4.4.0-184-generic-init-upstart-078e99ce-eb46-4324-bd9b-6dc10573508b' {
	menuentry 'Ubuntu, with Linux 4.4.0-184-generic (recovery mode)' --class ubuntu --class gnu-linux --class gnu --class os $menuentry_id_option 'gnulinux-4.4.0-184-generic-recovery-078e99ce-eb46-4324-bd9b-6dc10573508b' {
	menuentry 'Ubuntu, with Linux 4.4.0-179-generic' --class ubuntu --class gnu-linux --class gnu --class os $menuentry_id_option 'gnulinux-4.4.0-179-generic-advanced-078e99ce-eb46-4324-bd9b-6dc10573508b' {
	menuentry 'Ubuntu, with Linux 4.4.0-179-generic (upstart)' --class ubuntu --class gnu-linux --class gnu --class os $menuentry_id_option 'gnulinux-4.4.0-179-generic-init-upstart-078e99ce-eb46-4324-bd9b-6dc10573508b' {
	menuentry 'Ubuntu, with Linux 4.4.0-179-generic (recovery mode)' --class ubuntu --class gnu-linux --class gnu --class os $menuentry_id_option 'gnulinux-4.4.0-179-generic-recovery-078e99ce-eb46-4324-bd9b-6dc10573508b' {
	menuentry 'Ubuntu, with Linux 4.4.0-178-generic' --class ubuntu --class gnu-linux --class gnu --class os $menuentry_id_option 'gnulinux-4.4.0-178-generic-advanced-078e99ce-eb46-4324-bd9b-6dc10573508b' {
	menuentry 'Ubuntu, with Linux 4.4.0-178-generic (upstart)' --class ubuntu --class gnu-linux --class gnu --class os $menuentry_id_option 'gnulinux-4.4.0-178-generic-init-upstart-078e99ce-eb46-4324-bd9b-6dc10573508b' {
	menuentry 'Ubuntu, with Linux 4.4.0-178-generic (recovery mode)' --class ubuntu --class gnu-linux --class gnu --class os $menuentry_id_option 'gnulinux-4.4.0-178-generic-recovery-078e99ce-eb46-4324-bd9b-6dc10573508b' {
	menuentry 'Ubuntu, with Linux 4.4.0-21-generic' --class ubuntu --class gnu-linux --class gnu --class os $menuentry_id_option 'gnulinux-4.4.0-21-generic-advanced-078e99ce-eb46-4324-bd9b-6dc10573508b' {
	menuentry 'Ubuntu, with Linux 4.4.0-21-generic (upstart)' --class ubuntu --class gnu-linux --class gnu --class os $menuentry_id_option 'gnulinux-4.4.0-21-generic-init-upstart-078e99ce-eb46-4324-bd9b-6dc10573508b' {
	menuentry 'Ubuntu, with Linux 4.4.0-21-generic (recovery mode)' --class ubuntu --class gnu-linux --class gnu --class os $menuentry_id_option 'gnulinux-4.4.0-21-generic-recovery-078e99ce-eb46-4324-bd9b-6dc10573508b' {
menuentry 'Memory test (memtest86+)' {
menuentry 'Memory test (memtest86+, serial console 115200)' {
```

比如我当前的内核是Ubuntu，Linux 4.4.0-184-generic。我现在要切换为Ubuntu，Linux 4.4.0-21-generic

2. 切换方法

使用如下指令打开 grub 文件

```bash
sudo gedit /etc/default/grub
```

修改 grub 文件中的 GRUB_DEFAULT=“Ubuntu，Linux 4.4.0-21-generic”。

然后执行

```bash
sudo update-grub
```

这时候会有 WARNING 提示修改 GRUB_DEFAULT 的名称

```bash
Warning: Please don't use old title `Ubuntu, with Linux 4.4.0-179-generic' for GRUB_DEFAULT, use `Advanced options for Ubuntu>Ubuntu, with Linux 4.4.0-179-generic' (for versions before 2.00) or `gnulinux-advanced-078e99ce-eb46-4324-bd9b-6dc10573508b>gnulinux-4.4.0-179-generic-advanced-078e99ce-eb46-4324-bd9b-6dc10573508b' (for 2.00 or later)
```

根据提示可以使用 Advanced options for Ubuntu>Ubuntu, with Linux 4.4.0-179-generi 或者 gnulinux-advanced-078e99ce-eb46-4324-bd9b-6dc10573508b>gnulinux-4.4.0-179-generic-advanced-078e99ce-eb46-4324-bd9b-6dc10573508b 将上面的代码放在 GRUB_DEFAULT='' 单引号里面

```bash
GRUB_DEFAULT='gnulinux-advanced-078e99ce-eb46-4324-bd9b-6dc10573508b>gnulinux-4.4.0-179-generic-advanced-078e99ce-eb46-4324-bd9b-6dc10573508b'
```

两个最好都试一下

然后执行

```bash
sudo update-grub
```

然后重启

```bash
sudo reboot
```

启动过程中，如果出现选择启动项界面(如图1，这里默认选的是Advanced options for Ubuntu)，那什么都不要动，他自己过一会就会选默认的选项进去，进去以后发现内核正常，显卡驱动等都可以正常使用；如果选了上面的Ubuntu（图2）那就可能内核出错。

<center>

<img src="https://raw.githubusercontent.com/chiemon/chiemon.github.io/master/img/Ubuntu/1.png">

图1

<img src="https://raw.githubusercontent.com/chiemon/chiemon.github.io/master/img/Ubuntu/2.png">

图2

</center>
