---
layout: post
title: FCN 实战
category: 语义分割
tags: fcn
description:
---

## 一、FCN 8s-Caffe-VOC

### 1. 环境配置

- 编译安装 caffe, 并安装 python 接口：<https://github.com/BVLC/caffe>
- 下载FCN网络模型：<https://github.com/shelhamer/fcn.berkeleyvision.org>

### 2. 数据集说明

- PASCAL VOC

    语义分割标注有20个类和一个背景。

- Semantic Boundary Dataset (SBD)

    SBD 是 PASCAL VOC 数据集更进一步的标注，提供了更多的语义分割和实力分割的 mask。

注意 VOC2011 验证集与 SBD 训练集有交叉的部分。

模型数据集
- 训练集：SBD ( 8498 imgs )
- 验证集：VOC 2012 与训练集无交叉部分 ( seg11valid.txt )

### 3. 更改模型路径

模型目录：

    fcn.berkeleyvision.org/voc-fcn8s
        |_caffemodel-url        预训练权重的下载地址
        |_deploy.prototxt
        |_net.py                生成网络模型的文件，暂用不到
        |_solve.py
        |_solver.prototxt
        |_train.prototxt
        |_val.prototxt

~solve.py

```python
# -*- coding: UTF-8 -*-
+ import sys
+ sys.path.insert(0, '${caffe-root}/python')    # caffe python 接口
+ sys.path.append('fcn.berkeleyvision.org') # 把 FCN 模型加入 python 路径
...
* weights = './voc-fcn8s/fcn8s-heavy-pascal.caffemodel' # 下载好的预训练权重路径
...
- caffe.set_device(int(sys.argv[1]))
+ caffe.set_device(2) # 设置使用的gpu
...
* solver = caffe.SGDSolver('./voc-fcn8s/solver.prototxt')
...
* val = np.loadtxt('../data/pascal/seg11valid.txt', dtype=str)
```